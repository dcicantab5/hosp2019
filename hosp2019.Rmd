---
title: "Hospitals Inpatient Workload 2019"

author:
  - name: Dr Saiful Safuan Md Sani 
    url: https://saifulsafuan.com
    affiliation: Clinical Research Centre & Department of Medicine Hospital Kuala Lumpur
  - name: Dr Cheah Wee Kooi
    affiliation: Clinical Research Centre & Department of Medicine Hospital Taiping
  - name: Dr Yoon Chee Kin
    affiliation: Clinical Research Centre & Department of Medicine Hospital Pulau Pinang
date: "`2022-01-17`"
output: 
  distill::distill_article:
    self_contained: yes
    toc: yes
    toc_depth: 2
---

```{r setup, include=FALSE}
library(knitr)
library(distill)
library(googlesheets)
library(gsheet)
library(dplyr)
library(ggplot2)
library(plotly)
library(DT)
library(kableExtra)
#library(zoo) # moving averages
#library(RcppRoll) # running total
```
```{r chartstudio, include=FALSE}
#Sys.setenv("plotly_username"="dcicantab5")
#Sys.setenv("plotly_api_key"="zY42xxH3ClQIvgjdFZlH")
```

```{r urlshare, include=FALSE}
#### SHARING GEN MED WORKLOAD ####
#library(googlesheets4)
# read_sheet(urlshare, "data_combo_sharegen") #alternative

urlshare <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=710983312"
  #"https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=710983312"  
hosp2019share <- gsheet2tbl(urlshare, "data_combo_sharegen") 
```
```{r, include=FALSE}
hosp2019share$type <- as.factor(hosp2019share$type)
hosp2019share$type <- relevel(hosp2019share$type, "state")

rownames(hosp2019share) <- hosp2019share$hospital
rownames(hosp2019share)

#col3 <- c(`state` = "#150377", `major` = "salmon", `minor` = "grey")

hosp2019share$hospital <- factor(hosp2019share$hospital,
                   levels = hosp2019share$hospital)

datashare <- arrange(hosp2019share, type, desc(spec_n_per_1000_adm))
```

```{r url, include=FALSE}
#### ALL IN ####
url <- 'https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit?usp=sharing'  
# kkm data from datuk noel thomas from dr cheah wee kooi; email feb 2021
hosp2019 <- gsheet2tbl(url)
hosp2019$type <- as.factor(hosp2019$type)
hosp2019$type <- relevel(hosp2019$type, "state")

rownames(hosp2019) <- hosp2019$hospital
rownames(hosp2019)

col3 <- c(`state` = "#150377", `major` = "salmon", `minor` = "grey")

hosp2019$hospital <- factor(hosp2019$hospital,
                   levels = hosp2019$hospital)

data <- arrange(hosp2019, desc(spec_n_per_1000_adm))
```
```{r, message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}
levels(hosp2019$hospital)
```
```{r, message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}
str(hosp2019)
```
# Admissions
```{r, fig.cap="Gen Med admissions.", out.extra="class=external",  fig.width=8, fig.height=8, message=FALSE, echo=FALSE, warning=FALSE}
#### Current workload
col3 <- c(`state` = "#150377", `major` = "salmon", `minor` = "grey")

datashare_adm <- arrange(hosp2019share, admission)
datashare_adm$hospital <- factor(datashare_adm$hospital,
                   levels = datashare_adm$hospital)

p <- plot_ly(datashare_adm, y = ~factor(hospital), x = ~admission, alpha = 0.97, size = 7)
subplot(
  add_bars(p, color = ~factor(type), colors = col3,  showlegend = TRUE) 
) %>% layout(
     title = "Admissions <br><sup></sup>",
     yaxis = list(title = "",
     categoryorder = "array",
     categoryarray = ~datashare_adm$hospital, tickfont = list(size = 10)),
     xaxis = list(title = "Number of admissions")
) %>% layout(legend = list(x = 0.77, y = 0.9)) %>% 
 layout(annotations = 
 list(x = 1, y = 0.51, text = "", 
      showarrow = F, xref='paper', yref='paper', 
      xanchor='right', yanchor='auto', xshift=0, yshift=0,
      font=list(size=12, color="grey"))
 )


#options(browser = 'false')
#api_create(p, filename = "hosp2019_admission")
```

<a href="#top">Return to table of contents</a>

# Number of Specialists
```{r, fig.cap="Number of specialists involved in handling Gen Med admissions only.", out.extra="class=external",  fig.width=8, fig.height=8, message=FALSE, echo=FALSE, warning=FALSE}

col3 <- c(`state` = "#150377", `major` = "salmon", `minor` = "grey")

datashare_spec <- arrange(hosp2019share, spec_sharegen)
datashare_spec$hospital <- factor(datashare_spec$hospital,
                   levels = datashare_spec$hospital)

p <- plot_ly(datashare_spec, y = ~factor(hospital), x = ~spec_sharegen, alpha = 0.97, size = 13)
subplot(
  add_bars(p, color = ~factor(type), colors = col3,  showlegend = TRUE) 
) %>% layout(
     title = "Specialists <br><sup></sup>",
     yaxis = list(title = "",
     categoryorder = "array",
     categoryarray = ~datashare_spec$hospital, tickfont = list(size = 10)),
     xaxis = list(title = "Number of specialists")
) %>% layout(legend = list(x = 0.77, y = 0.9)) %>% 
 layout(annotations = 
 list(x = 1, y = 0.51, text = "", 
      showarrow = F, xref='paper', yref='paper', 
      xanchor='right', yanchor='auto', xshift=0, yshift=0,
      font=list(size=12, color="grey"))
 )


#options(browser = 'false')
#api_create(p, filename = "hosp2019_spec_n")
```
<a href="#top">Return to table of contents</a>

# Standardised Workload
```{r, fig.cap="Standardised Inpatient Workload. Denominator is Gen Med admissions.", out.extra="class=external", message=FALSE, echo=FALSE, warning=FALSE}
states <- datashare %>% filter(type == 'state')
states$hospital <- factor(states$hospital)
#str(states)

p_states <- plot_ly(states, y = ~hospital, x = ~spec_n_per_1000_adm, type = 'bar',  name = 'States', color = ~factor(type), colors = col3)
p_states <- p_states %>% add_trace(states, y = ~hospital, x = ~median, 
                      type = 'scatter', 
                      name = 'Median',
                      mode = "lines", 
                      line = list(color = "crimson", dash = 'dot', width = 7), 
                      opacity = 0.97)
p_states <- p_states %>% layout(xaxis = list(title = 'Number of specialists per 1000 admissions'), yaxis = list(title = '', categoryorder = "total ascending", tickfont = list(size = 8)))

#p_states

major <- datashare %>% filter(type == 'major')
major$hospital <- factor(major$hospital)
#str(major)

p_major <- plot_ly(major, y = ~hospital, x = ~spec_n_per_1000_adm, type = 'bar',  name = 'Major', color = ~factor(type), colors = col3)
p_major <- p_major %>% add_trace(major, y = ~hospital, x = ~median, 
                      type = 'scatter', 
                      name = 'Median',
                      mode = "lines", 
                      line = list(color = "crimson", dash = 'dot', width = 7), 
                      opacity = 0.97)
p_major <- p_major %>% layout(xaxis = list(title = 'Number of specialists per 1000 admissions'), yaxis = list(title = '', categoryorder = "total ascending", tickfont = list(size = 8)))

#p_major

minor <- datashare %>% filter(type == 'minor')
minor$hospital <- factor(minor$hospital)
#str(minor)

p_minor <- plot_ly(minor, y = ~hospital, x = ~spec_n_per_1000_adm, type = 'bar',  name = 'Minor', color = ~factor(type), colors = col3)
p_minor <- p_minor %>% add_trace(minor, y = ~hospital, x = ~median, 
                      type = 'scatter', 
                      name = 'Median',
                      mode = "lines", 
                      line = list(color = "crimson", dash = 'dot', width = 7), 
                      opacity = 0.97)
p_minor <- p_minor %>% layout(xaxis = list(title = 'Number of specialists per 1000 admissions'), yaxis = list(title = '', categoryorder = "total ascending", tickfont = list(size = 8)))

#p_minor
```

```{r, fig.cap="Standardised Inpatient Workload. Denominator is Gen Med admissions.", out.extra="class=external",  fig.width=8, fig.height=8, message=FALSE, echo=FALSE, warning=FALSE}
subplot(p_states, p_major, p_minor , nrows = 3, heights = c(0.25, 0.5, 0.25), shareX = TRUE, shareY = TRUE) %>% 
  layout(title = list(text = "Standardised Inpatient Workload by Type of Facility"))

#options(browser = 'false')
#api_create(p, filename = "hosp2019_spec_n_per_1000_adm")
```
<a href="#top">Return to table of contents</a>

<br>

$${Adequacy = {Std\;Workload}_{Current} - \displaystyle \left[{Std\;Workload}_{Median} \left( \displaystyle \frac{Workload}{1000}\right)\right]}$$
<br>  

# Specialist Excesses and Shortages: 
## *Current Sharing General Medicine Workload*
```{r, fig.cap="\\label{fig:myfig4}Specialist Excesses and Shortages. Negative values are shortages, and positive values are excesses. Calculation of the value for each hospital is by deducting the median standardised workload (of the respective type of facility) from a hospital's current standardised workload. The number in shortage/excess is then derived using that hospital's current workload.", out.extra="class=external",  fig.width=8, fig.height=8, message=FALSE, echo=FALSE, warning=FALSE}

col3 <- c(`state` = "#150377", `major` = "salmon", `minor` = "grey")

datashare <- arrange(hosp2019share, spec_adequacy)
datashare$hospital <- factor(datashare$hospital,
                   levels = datashare$hospital)

p <- plot_ly(datashare, y = ~factor(hospital), x = ~spec_adequacy, alpha = 0.97, size = 13)
subplot(
  add_markers(p, color = ~factor(type), colors = col3,  showlegend = TRUE) 
) %>% layout(
     title = "Specialist Excesses and Shortages",
     yaxis = list(title = "",
     categoryorder = "array",
     categoryarray = ~datashare$hospital, tickfont = list(size = 8)),
     xaxis = list(title = "Number of specialists")
) %>% layout(legend = list(x = 0.77, y = 0.8))
```
<a href="#top">Return to table of contents</a>

# Specialist Excesses and Shortages: 
## *All-in*
```{r, fig.cap="Specialist Excesses and Shortages. Negative values are shortages, and positive values are excesses, relative to the median of the corresponding hospital type. Calculation of the value for each hospital is by deducting the median standardised workload (of the respective type of facility) from a hospital's current standardised workload. The number in shortage/excess is then derived for that hospital's current workload. ", out.extra="class=external",  fig.width=8, fig.height=8, message=FALSE, echo=FALSE, warning=FALSE}

col3 <- c(`state` = "#150377", `major` = "salmon", `minor` = "grey")

data <- arrange(hosp2019, spec_adequacy)
data$hospital <- factor(data$hospital,
                   levels = data$hospital)

p <- plot_ly(data, y = ~factor(hospital), x = ~spec_adequacy, alpha = 0.97, size = 13)
subplot(
  add_markers(p, color = ~factor(type), colors = col3,  showlegend = TRUE) 
) %>% layout(
     title = "Specialist Excesses and Shortages",
     yaxis = list(title = "",
     categoryorder = "array",
     categoryarray = ~data$hospital, tickfont = list(size = 8)),
     xaxis = list(title = "Number of specialists")
) %>% layout(legend = list(x = 0.77, y = 0.8))
```
<a href="#top">Return to table of contents</a>

# General Medicine & Subspecialties
```{r urlgensub, include=FALSE}
urlgensub <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=565087130"
  #"https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=710983312"  
gensub <- gsheet2tbl(urlgensub, "gen_subs") 
```
```{r, include=FALSE}
gensub$type <- as.factor(gensub$type)
gensub$type <- relevel(gensub$type, "state")

rownames(gensub) <- gensub$hospital

#col3 <- c(`state` = "#150377", `major` = "salmon", `minor` = "grey")

gensub$hospital <- factor(gensub$hospital,
                   levels = gensub$hospital)

datagensub <- arrange(gensub, type, desc(Subs_prop))
```
```{r states_gs, message=FALSE, echo=FALSE, warning=FALSE}
states_gs <- datagensub %>% filter(type == 'state')
states_gs <- arrange(states_gs, type, Subs_prop)
p_states_gs <- plot_ly(states_gs, y = ~hospital, 
                       x = ~Subs_prop*100,
                       type = 'bar',
                       name = "States Subs Prop",
                       color = ~type,
                       colors = col3) %>% 
  add_trace(x = ~GenMed_prop*100,
            name = "States Gen Med Prop",
            opacity = 0.5) %>% 
  layout(yaxis = list(title = "", categoryorder = "array", categoryarray =states_gs$hospital, tickfont = list(size = 8)), 
         barmode = "stack",
         xaxis = list(title = "Proportion", titlefont = list(size=8), tickfont = list(size=8)))

#p_states_gs
```

```{r major_gs, message=FALSE, echo=FALSE, warning=FALSE}
major_gs <- datagensub %>% filter(type == 'major')
major_gs <- arrange(major_gs, type, Subs_prop)
p_major_gs <- plot_ly(major_gs, y = ~hospital, 
                       x = ~Subs_prop*100,
                       type = 'bar',
                       name = "Major Subs Prop",
                       color = ~type,
                       colors = col3) %>% 
  add_trace(x = ~GenMed_prop*100,
            name = "Major Gen Med Prop",
            opacity = 0.5) %>% 
  layout(yaxis = list(title = "", categoryorder = "array", categoryarray =major_gs$hospital, tickfont = list(size = 8)), 
         barmode = "stack",
         xaxis = list(title = "Proportion", titlefont = list(size=8), tickfont = list(size=8)))

#p_major_gs
```

```{r minor_gs, message=FALSE, echo=FALSE, warning=FALSE}
minor_gs <- datagensub %>% filter(type == 'minor')
minor_gs <- arrange(minor_gs, type, Subs_prop)
p_minor_gs <- plot_ly(minor_gs, y = ~hospital, 
                       x = ~Subs_prop*100,
                       type = 'bar',
                       name = "Minor Subs Prop",
                       color = ~type,
                       colors = col3) %>% 
  add_trace(x = ~GenMed_prop*100,
            name = "Minor Gen Med Prop",
            opacity = 0.5) %>% 
  layout(yaxis = list(title = "", categoryorder = "array", categoryarray =minor_gs$hospital, tickfont = list(size = 8)), 
         barmode = "stack",
         xaxis = list(title = "Proportion", titlefont = list(size=8), tickfont = list(size=8)))

#p_minor_gs
```
```{r, fig.cap="General medicine & subspecialties proportions.", out.extra="class=external",  fig.width=8, fig.height=8, message=FALSE, echo=FALSE, warning=FALSE}
subplot(p_states_gs, p_major_gs, p_minor_gs , nrows = 3, heights = c(0.25, 0.5, 0.25), shareX = TRUE, shareY = TRUE) %>% 
  layout(title = list(text = "General Medicine & Subspecialties Manpower by Type of Facility"))

#options(browser = 'false')
#api_create(p, filename = "gensub")
```
<a href="#top">Return to table of contents</a>

***

# Case studies
## Case Study 1 - Drilldown QE  


***Subs_prop:*** *proportion of subs*
<br> ***GenMed_prop:*** *proportion of gen med*
<br> ***Total:*** *total number of specialists*
<br> ***Median_current:*** *median standardised workload based on current gen med work sharing*
<br> ***ES_current:*** *excess/shortage of specialists based on current gen med work sharing*
<br> ***Median_all:*** *median standardised workload based on all subs contributing to gen med work*
<br> ***ES_all:*** *excess/shortage of specialists based on all subs contributing to gen med work*

```{r}
url_cases <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=1867701472"

cases <- gsheet2tbl(url_cases, "casestudy")  

cases$type <- as.factor(cases$type)
cases$type <- relevel(cases$type, "state")

rownames(cases) <- cases$hospital

cases$hospital <- factor(cases$hospital,
                   levels = cases$hospital)

cases %>%
  filter(hospital=="QUEEN ELIZABETH") %>%
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "green"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "green"),
              popover = paste("am:", cases$Total))
```

```{r csqe, message=FALSE, echo=FALSE, warning=FALSE}

urlcsqe <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=1808792127"

csqe <- gsheet2tbl(urlcsqe, "cs_qe")


csqe %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center") %>%
  row_spec(1, color = "#150377") 
```
*QE workload based on composition. General medicine++: General medicine+ plus other contributing subs with segregated admissions data in SMRP. Dermatology not involved in Gen Med workload.*

<a href="#top">Return to table of contents</a>


## Case Study 2 - Drilldown HUS

```{r}
cases %>%
  filter(hospital=="UMUM SARAWAK") %>%
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "green"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "green"),
              popover = paste("am:", cases$Total))
```

```{r cshus, message=FALSE, echo=FALSE, warning=FALSE}

urlcshus <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=1454553381"

cshus <- gsheet2tbl(urlcshus, "cs_hus")


cshus %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center") %>%
  row_spec(1, color = "#150377")
#gm+ (Gastro, Endoc, Gery, Nephro, Pall)
```
*HUS workload based on composition. General medicine+: SMRP did not segragate data by subs; shared workload with existing contributing subs. General medicine++: General medicine+ plus other contributing subs with segregated admissions data in SMRP. Dermatology not involved in Gen Med workload.*

<a href="#top">Return to table of contents</a>

## Case Study 3 - Drilldown HKL

```{r}
cases %>%
  filter(hospital=="KUALA LUMPUR") %>% 
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "red"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "green"),
              popover = paste("am:", cases$Total)) 

```

```{r cshkl, message=FALSE, echo=FALSE, warning=FALSE}

urlcshkl <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=898591304"

cshkl <- gsheet2tbl(urlcshkl, "cs_hkl")


cshkl %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center") %>%
  row_spec(1:3, color = "#150377")
```
*HKL workload based on composition. General medicine+: SMRP did not segragate data by subs; shared workload with existing contributing subs.*

<a href="#top">Return to table of contents</a>

## Case Study 4 - Drilldown Serdang

```{r}
cases %>%
  filter(hospital=="SERDANG") %>%
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "green"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "green"),
              popover = paste("am:", cases$Total))
```
  
```{r csserdang, message=FALSE, echo=FALSE, warning=FALSE}

urlcsserdang <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=57638925"

csserdang <- gsheet2tbl(urlcsserdang, "cs_serdang")


csserdang %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center") %>%
  row_spec(1:2, color = "rgba(250,128,114,1)")
```
*Serdang workload based on composition. General medicine+: SMRP did not segragate data by subs; shared workload with existing contributing subs.*

<a href="#top">Return to table of contents</a>

## Case Study 5 - Drilldown Melaka

```{r}
cases %>%
  filter(hospital=="MELAKA") %>%
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "red"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "red"),
              popover = paste("am:", cases$Total))
```

```{r csmelaka, message=FALSE, echo=FALSE, warning=FALSE}

urlcsmelaka <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=1173288709"

csmelaka <- gsheet2tbl(urlcsmelaka, "cs_melaka")


csmelaka %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center") %>%
  row_spec(1, color = "#150377")
```
*Melaka workload based on composition. General medicine++: General medicine plus other contributing subs with segregated admissions data in SMRP. Dermatology not involved in Gen Med workload.*

<a href="#top">Return to table of contents</a>

## Case Study 6 - Drilldown TENGKU AMPUAN AFZAN

```{r}
cases %>%
  filter(hospital=="TENGKU AMPUAN AFZAN") %>%
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "green"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "green"),
              popover = paste("am:", cases$Total))
```

```{r cshtaa, message=FALSE, echo=FALSE, warning=FALSE}

urlcshtaa <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=2057673234"

cshtaa <- gsheet2tbl(urlcshtaa, "cs_htaa")


cshtaa %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center") %>%
  row_spec(1:3, color = "#150377")
```
*HTAA workload based on composition. General medicine+: SMRP did not segragate data by subs; shared workload with existing contributing subs.*

<a href="#top">Return to table of contents</a>

## Case Study 7 - Drilldown SULTANAH AMINAH

```{r}
cases %>%
  filter(hospital=="SULTANAH AMINAH") %>%
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "red"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "red"),
              popover = paste("am:", cases$Total))
```

```{r cshsa, message=FALSE, echo=FALSE, warning=FALSE}

urlcshsa <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=2062444221"

cshsa <- gsheet2tbl(urlcshsa, "cs_hsa")


cshsa %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center") %>%
  row_spec(1:2, color = "#150377")
```
*HSA workload based on composition. General medicine+: SMRP partially segragate data by subs; shared workload with some of the existing contributing subs. General medicine++: General medicine+ plus other contributing subs with segregated admissions data in SMRP. Dermatology & Cardiology are not involved in Gen Med workload.*

<a href="#top">Return to table of contents</a>

## Case Study 8 - Drilldown SEBERANG JAYA

```{r}
cases %>%
  filter(hospital=="SEBERANG JAYA") %>%
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "green"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "red"),
              popover = paste("am:", cases$Total))
```

```{r cssj, message=FALSE, echo=FALSE, warning=FALSE}

urlcssj <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=1014959329"

cssj <- gsheet2tbl(urlcssj, "cs_sj")


cssj %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center") 
```
*Seberang Jaya workload based on composition. General medicine+: SMRP partially segragate data by subs; shared workload with some of the existing contributing subs. General medicine++: General medicine+ plus other contributing subs with segregated admissions data in SMRP. All subs are involved in Gen Med workload.*

<a href="#top">Return to table of contents</a>

## Case Study 9 - Drilldown SULTAN HJ AHMAD SHAH

```{r}
cases %>%
  filter(hospital=="SULTAN HJ AHMAD SHAH") %>%
  kbl("html", align = "c", escape = F) %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 10, position = "center") %>%
  kable_paper(full_width = F) %>%
  column_spec(7, color = "white", bold = T,
              background = ifelse(cases$ES_current < 0, "red", "red"),
              popover = paste("am:", cases$Total)) %>%
  column_spec(9, color = "white", bold = T,
              background = ifelse(cases$ES_all < 0, "red", "red"),
              popover = paste("am:", cases$Total))
```

```{r csshas, message=FALSE, echo=FALSE, warning=FALSE}

urlcsshas <- "https://docs.google.com/spreadsheets/d/1SFtj8JD1JDLMUdUExFoovDt6uIAFh5pWSpxPzZ_xK1Q/edit#gid=250197512"

csshas <- gsheet2tbl(urlcsshas, "cs_shas")


csshas %>%
  kbl("html", align = "c") %>%
  kable_material(c("hover")) %>% 
  kable_styling(font_size = 12, position = "center")
```
*HOSHAS workload based on composition. General medicine+: SMRP did not segragate data by subs; shared workload with existing contributing subs. All subs are involved in Gen Med workload.*

<a href="#top">Return to table of contents</a>

